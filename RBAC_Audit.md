# LMS RBAC Security Audit Report

## 1. Executive Summary
This report details the Role-Based Access Control (RBAC) architecture of the Veriton LMS, covering both frontend (React) and backend (.NET Web API). The system implements a hierarchical access model ensuring that sensitive administrative functions are restricted to authorized users while maintaining a seamless experience for students and teachers.

## 2. Global Identity Mapping
The system uses a standardized identity matrix to map backend roles to frontend user types (`utype`).

| Backend Role | Frontend `utype` | Description |
|--------------|------------------|-------------|
| `SuperAdmin` | `admin`          | Global network control, all schools. |
| `Admin`      | `admin`          | Equivalent to SuperAdmin in most contexts. |
| `Staff`      | `staff`          | Institutional management (grades, modules, lessons). |
| `Principal`  | `principal`      | School-specific leadership and oversight. |
| `Teacher`    | `teacher`        | Instructional management and attendance. |
| `Student`    | `student`        | Core learner experience and progress tracking. |

## 3. Frontend Navigation Security
The `Sidebar.tsx` component serves as the primary gateway for authorized navigation. Links are conditionally rendered based on the `user.utype` property.

### 3.1 Role-Specific Dashboards
- **Admin**: `/admin/dashboard` (Insight Engine with global stats)
- **Principal**: `/principal/dashboard` (Data-driven command center with charts)
- **Staff**: `/staff/dashboard` (Operational stats and quick actions)
- **Teacher**: `/teacher/dashboard` (Shared with Principal/Staff but restricted views)
- **Student**: `/student/dashboard` (Lesson accordion and progress tracker)

## 4. Backend Authorization Policies
Security is enforced at the controller level using .NET Authorization Policies defined in `Program.cs`.

| Policy | Allowed Roles | Typical Usage |
|--------|---------------|---------------|
| `AdminOnly` | SuperAdmin, Admin | School creation, Global deletions. |
| `StaffOnly` | Admin, Staff | Grade/Division management, User provisioning. |
| `PrincipalOnly`| Admin, Staff, Principal | Teacher management, School-level stats. |
| `TeacherOnly` | Admin, Staff, Principal, Teacher | Exam creation, Sheduler management. |
| `StudentOnly` | All Authenticated Users | Lessons view, Personal progress. |

## 5. Audit Findings & Critical Identifiers
### 5.1 Successes
- **Hierarchical Fallback**: Higher roles are explicitly granted lower-tier permissions (e.g., Staff can perform Teacher actions).
- **Token Integrity**: JWT tokens are used for session verification across all API requests.
- **Dynamic UI**: Navigation items are strictly tied to roles, preventing unauthorized access to UI components.

### 5.2 Identified Risks & Fixes Applied
- **Route Sync**: Redirect logic in `App.tsx` was synchronized to ensure users land on their specific dashboard after authentication.
- **Identity Sprawl**: Duplicate menu items for "Provisioning" were unified under the "Identity Matrix" in `Users.tsx`.
- **Typo Resilience**: Standardized on `principal` across the stack to prevent routing failures.

## 6. Recommendations
- **Audit Logs**: Implement a backend activity log for sensitive actions (e.g., user deletion, password resets).
- **MFA**: Consider Multi-Factor Authentication for Admin and Staff roles.
- **Explicit Principal Scope**: Ensure Principals can only see data for their assigned `school_id` (partial progress made in `Students.tsx`).

---
*Report generated by Antigravity AI - Senior Enterprise LMS Architect.*
